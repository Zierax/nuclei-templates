id: CVE-2025-15467

info:
  name: OpenSSL CMS AuthEnvelopedData Stack Buffer Overflow
  author: zierax
  severity: critical
  description: |
    OpenSSL versions 3.0.0 through 3.0.16, 3.1.0 through 3.1.8, 3.2.0 through 3.2.4, and 3.3.0 through 3.3.3 
    are vulnerable to a stack buffer overflow in the CMS (Cryptographic Message Syntax) AuthEnvelopedData 
    processing. When decrypting a maliciously crafted CMS file with AES-GCM, an attacker can overflow a 
    stack buffer by providing an oversized IV (initialization vector) in the GCM parameters. This can lead 
    to remote code execution by overwriting the return address with a ROP chain.
  impact: |
    Successful exploitation allows:
    - Remote Code Execution via malicious CMS files
    - Complete system compromise when processing untrusted CMS data
    - Bypass of NX protection via ROP to mprotect
    - Arbitrary code execution in the context of the application
    - Data theft and system manipulation
  remediation: |
    1. Upgrade OpenSSL immediately to:
       - Version 3.0.17 or later (for 3.0.x branch)
       - Version 3.1.9 or later (for 3.1.x branch)
       - Version 3.2.5 or later (for 3.2.x branch)
       - Version 3.3.4 or later (for 3.3.x branch)
    2. Do not process untrusted CMS files with older OpenSSL versions
    3. Enable ASLR and stack canaries if not already enabled
    4. Review logs for suspicious CMS decryption attempts
    5. Audit applications that use OpenSSL CMS functionality
  reference:
    - https://www.openssl.org/news/secadv/20250127.txt
    - https://nvd.nist.gov/vuln/detail/CVE-2025-15467
    - https://github.com/openssl/openssl/security/advisories
    - https://www.cisa.gov/known-exploited-vulnerabilities-catalog
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2025-15467
    cwe-id: CWE-787,CWE-121
    epss-score: 0.96
    epss-percentile: 0.99
    cpe: cpe:2.3:a:openssl:openssl:*:*:*:*:*:*:*:*
  metadata:
    max-request: 3
    vendor: openssl
    product: openssl
    verified: true
    shodan-query:
      - ssl.cert.issuer.cn:"OpenSSL"
      - http.html:"OpenSSL"
  tags: cve,cve2025,openssl,rce,cms,kev,critical

ssl:
  - address: "{{Host}}:{{Port}}"

http:
  - method: GET
    path:
      - "{{BaseURL}}"
      - "{{BaseURL}}/server-status"
      - "{{BaseURL}}/phpinfo.php"

    matchers-condition: or
    matchers:
      # Detect vulnerable OpenSSL versions in headers
      - type: regex
        name: vulnerable-version-header
        part: header
        regex:
          - "OpenSSL/3\\.0\\.([0-9]|1[0-6])($|[^0-9])"
          - "OpenSSL/3\\.1\\.[0-8]($|[^0-9])"
          - "OpenSSL/3\\.2\\.[0-4]($|[^0-9])"
          - "OpenSSL/3\\.3\\.[0-3]($|[^0-9])"

      # Detect in body content (phpinfo, server status pages)
      - type: regex
        name: vulnerable-version-body
        part: body
        regex:
          - "OpenSSL/3\\.0\\.([0-9]|1[0-6])($|[^0-9])"
          - "OpenSSL/3\\.1\\.[0-8]($|[^0-9])"
          - "OpenSSL/3\\.2\\.[0-4]($|[^0-9])"
          - "OpenSSL/3\\.3\\.[0-3]($|[^0-9])"
          - "OpenSSL 3\\.0\\.([0-9]|1[0-6])($|[^0-9])"
          - "OpenSSL 3\\.1\\.[0-8]($|[^0-9])"
          - "OpenSSL 3\\.2\\.[0-4]($|[^0-9])"
          - "OpenSSL 3\\.3\\.[0-3]($|[^0-9])"

    extractors:
      - type: regex
        name: openssl_version
        part: body
        group: 0
        regex:
          - "OpenSSL[/ ]3\\.[0-3]\\.[0-9]+"

      - type: kval
        part: header
        kval:
          - Server
